# 
# AO188_2.yml -- AO188 launchers file for LGS mode
#
# This is a YAML file

tabname: "AO188 (LGS)"
launchers:

###########################
# LGS initial calibration #
###########################
    - 
        label: "Set LGS height" 
        cmd  : AO188_SETLGSH OBE_ID=AO188 OBE_MODE=LAUNCHER VAL=$VAL01 EL=$VAL02 AU1FOC=$VAL03 GSMODE="LGS"
        params:
            - [ VAL01, LIST, [ "CURRENT", "INPUT", "DEFAULT" ], "Value"]
            - [ VAL02, INPUT, 8, "!TSCS.EL", "EL(deg)" ]
            - [ VAL03, INPUT, 8, "!AON.AU1.FOC", "AU1FOC(mm)" ]

    - 
        label: "Track LGS focus" 
        cmd  : AO188_TRKLGSFOC OBE_ID=AO188 OBE_MODE=LAUNCHER GSMODE="LGS"

    - sep

###########################
# LGS initial calibration #
###########################
    - 
        label: "LLT shutter" 
        cmd  : LGS_LLTSHUT OBE_ID=LGS OBE_MODE=LAUNCHER CMD=$VAL01 GSMODE="LGS"
        params:
            - [ VAL01, LIST, [ "CLOSE", "OPEN" ], "cmd"]

    - sep

#######
# AU1 #
#######
    - 
        label: "LGS acquisition"
        cmd  : AO188_ACQLGS OBE_ID=AO188 OBE_MODE=AO188_SETUP EXPTIME=$VAL01 LGSAP=$VAL02 
        params:
            - [ VAL01, INPUT, 6, 15.0, "EXP. time" ]
            - [ VAL02, LIST, [ ["4 arcsec", 4ASEC], ["2 arcsec", 2ASEC] , ["1 arcsec", 1ASEC]], "LGSAP" ]
 
    - 
        label: "Acq. LGS on AQCAM" # AO acquisition
        cmd  : AO188_WACQ OBE_ID=AO188 OBE_MODE=LAUNCHER X_PIX=$VAL01 Y_PIX=$VAL02 DEV=AU1
        params:
            - [ VAL01, INPUT, 6, 0.0, "X(AQCAM)" ]
            - [ VAL02, INPUT, 6, 0.0, "Y(AQCAM)" ]

    - sep

#######
# AU2 #
#######
    - 
        label: "Set LOWFS AO Point (pix)" # AO acquisition
        cmd  : AO188_AOPSET OBE_ID=AO188 OBE_MODE=LAUNCHER X_PIX=$VAL01 Y_PIX=$VAL02 PIXSCALE=$VAL03 INSTRUMENT=$VAL04 GSMODE="LGS"
        params:
            - [ VAL01, INPUT, 6, 0.0, "X" ]
            - [ VAL02, INPUT, 6, 0.0, "Y" ]
            - [ VAL03, LIST, [ "52MAS", "20MAS", "12MAS", "10MAS" ], "Pixel Scale" ]
            - [ VAL04, LIST, [ ["IRCS", IRCS], ["HiCIAO", HICIAO] ], "Instrument" ]
           
    - 
        label: "Offset pix by AU2" # AO acquisition offset
        cmd  : AO188_AOOFFSET OBE_ID=AO188 OBE_MODE=LAUNCHER X_PIX=$VAL01 Y_PIX=$VAL02 PIXSCALE=$VAL04 INSTRUMENT=$VAL07 COORD=$VAL06 MODE=$VAL05 TTSTEP=$VAL03 GSMODE="LGS"
        params:
            - [ VAL01, INPUT, 6, 0.0, "dX" ]
            - [ VAL02, INPUT, 6, 0.0, "dY" ]
            - [ VAL03, INPUT, 2, 1, "Step" ]
            - break
            - [ VAL04, LIST, [ "52MAS", "20MAS", "12MAS", "10MAS" ],
                "Pixel Scale" ]
            - [ VAL05, LIST, [["TT", TT], ["TT NULL", TTNULL],
                             ["AO POINT", AOP]], "Mode" ]
            - [ VAL06, LIST, [["Sdrl", ABS], ["N-Sdrl", FILE]], "Type" ]
            - [ VAL07, LIST, [["IRCS", IRCS], ["HiCIAO", HICIAO]], "Instrument" ]

    - sep

##################
# LA shutter/FW  #
##################
# LA filter wheel (GO)
    - 
        label: "LAFW (Go)"
        cmd  : AO188_LAFW_GO OBE_ID=AO188 OBE_MODE=LAUNCHER VAL=$VAL01 DEV="$VAL02"
        params:
            - [ VAL01, LIST, [["Close", CLOSE], ["Auto", "AUTO"], "ND0.01", "ND0.03", "ND0.1",  "ND0.3", "ND1", "ND3", "ND10", "ND30", ["Open", OPEN]] , "FW"]
            - [ VAL02, SELECT, ["HOWFS","LOWFS","ALL"], "WFS"]

# LA filter wheel (step)
    - 
        label: "LAFW (Step)"
        cmd  : AO188_LAFW_STEP OBE_ID=AO188 OBE_MODE=LAUNCHER VAL="$VAL01" DEV="$VAL02"
        params:
            - [ VAL01, LIST, [["10 times darker", "STEP10-"], ["3 times darker", "STEP3-"], ["3 times brighter", "STEP3+"], ["10 times brighter", "STEP10+"]], "Step" ]
            - [ VAL02, SELECT, ["HOWFS","LOWFS"], "WFS"]

# APDshutter
    - 
        label: "LA shutter"     # APD shutter
        cmd  : AO188_APD_SHUT OBE_ID=AO188 OBE_MODE=LAUNCHER VAL=$VAL01 DEV="$VAL02"
        params:
            - [ VAL01, LIST, [ ["Close", CLOSE] , ["Open", OPEN] ] ]
            - [ VAL02, SELECT, ["HOWFS","LOWFS","ALL"], "WFS"]

    - sep

###########
# Loop control   #
###########
    - 
        label: "Set VMvolt"  # Set voltage
        cmd  : AO188_VMVOLT OBE_ID=AO188 OBE_MODE=LAUNCHER VOLT=$VAL01
        params:
            - [ VAL01, INPUT, 6, 0.1, "volt" ]

    -
        label: "High-order LOOP"     # Close High order loop with LGS
        cmd  : AO188_CLOSE_LGSLOOP OBE_ID=AO188 OBE_MODE=LAUNCHER WTT=$VAL01 DMG=$VAL02 LOOP=HO
        params:
            - [ VAL01, INPUT, 6, 0.0, "WTT" ]
            - [ VAL02, INPUT, 6, 0.0, "DMG" ]
    -
        label: "Low-order LOOP"     # Close High order loop with LGS
        cmd  : AO188_CLOSE_LGSLOOP OBE_ID=AO188 OBE_MODE=LAUNCHER LTT=$VAL01 LDF=$VAL02 TTG=$VAL03 LOOP=LO
        params:
            - [ VAL01, INPUT, 6, 0.0, "LTT" ]
            - [ VAL02, INPUT, 6, 0.0, "LDF" ]
            - [ VAL03, INPUT, 6, 0.0, "TTG" ]

    -
        label: "ADF LOOP"     # Close defocus offloading loop
        cmd  : AO188_ADF OBE_ID=AO188 OBE_MODE=LAUNCHER LOOP=$VAL01 GAIN=$VAL02
        params:
            - [ VAL01, SELECT, [ "ON", "OFF" ]]
            - [ VAL02, INPUT, 6, 0.0, "Gain" ]

    - 
        label: "Set Loop"     # AO188 loop
        cmd  : AO188_LOOP OBE_ID=AO188 OBE_MODE=LAUNCHER VAL=$VAL01 GSMODE="LGS"
        params:
            - [ VAL01, LIST, ["STOP", "PAUSE", "RESUME", "HPAUSE", "HRESUME", "LPAUSE", "LRESUME"], "state" ]

    - 
        label: "Gain"     # AO188 loop gain for LGS mode
        cmd  : AO188_SETGAIN OBE_ID=AO188 OBE_MODE=LAUNCHER TARGET=$VAL01 GAIN=$VAL02
        params:
            - [ VAL01, LIST, ["CLEAR", "WTT", "LTT", "LDF", "HTT", "HDF", "DMG", "TTG", "PSS"], "Target" ]
            - [ VAL02, INPUT, 6, 0.0, "Gain" ]
    - sep

###############
# TT null (AUTO FEED)   #
###############
#
# AO TT Nulling with automatic parameter feed 
#
    - 
        label: "TToffload" # Correction of AO TT mirror by moving telescope
        cmd  : AO188_TTNULL_AUTO_STEP OBE_ID=AO188 OBE_MODE=LAUNCHER COORD=$VAL01 STEP=$VAL02 SLEEP=$VAL03 
        params:
            - [ VAL01, LIST, [["Sidereal", ABS], ["Non-Sidereal", FILE]], "Type" ]
            - [ VAL02, INPUT, 6, 1, "step"]
            - [ VAL03, INPUT, 6, 3, "sleep"]

    - 
        label: "WTT flat" # Correction of AO WTT mirror by moving AU1
        cmd  : AO188_WTTFLAT OBE_ID=AO188 OBE_MODE=LAUNCHER

    - sep

############
# Aperture #
############
    - 
        label: "Aperture"
        cmd:   AO188_AP OBE_ID=AO188 OBE_MODE=LAUNCHER AP=$VAL01 POS=$VAL02
        params:
            - [ VAL01, LIST, ["NGSAP", "LGSAP", "AP1"], "Aperture"] 
            - [ VAL02, LIST, [["20asec", "20ASEC"], ["4asec", "4ASEC"], ["2asec", "2ASEC"], ["1asec", "1ASEC"], ["Mirror", "MIRROR"]]]

    - 
        label: "Iris"
        cmd  : AO188_IRIS OBE_ID=AO188 OBE_MODE=LAUNCHER AP="$VAL01" CMD="$VAL02" VAL=$VAL03
        params:
            - [ VAL01, LIST, ["VMAP", "AP2"], "Iris"] 
            - [ VAL02, LIST, [["Full", FULL], ["MOVREL", MOVREL], ["MOVABS", MOVABS]] ]
            - [ VAL03, INPUT, 6, 0.0, "arcsec" ]

    - sep

#END
